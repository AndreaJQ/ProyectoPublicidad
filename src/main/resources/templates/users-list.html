<html xmlns:th="http://thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
  <title>Users List</title>
</head>

<body>
<section layout:fragment="body">
<main class="main-gris">
  <div class="container">
    <div class="d-flex fles-row justify-content-between align-items-center">
      <h1>Lista de Usuarios</h1>
      <a class="btn btn-outline-success" th:href="@{/admin/exportarPDF}" type="button">Exportar a pdf</a>
      <a class="btn btn-outline-success" th:href="@{/admin/exportarExcel}" type="button">Exportar a Excel</a>
      <a class="btn btn-outline-success" th:href="@{/user/perfil}" type="button">Volver</a>
    </div>
  <table class="table" id="userTable">
    <thead>
    <tr>
      <th onclick="sortTable(0)" class="desc">ID</th>
      <th onclick="sortTable(1)" class="desc">NOMBRE</th>
      <th onclick="sortTable(2)" class="desc">APELLIDO</th>
      <th onclick="sortTable(3)" class="desc">EMAIL</th>
      <th onclick="sortTable(4)" class="desc">ROL</th>
      <th onclick="sortTable(5)" class="desc">ESTADO</th>
      <!--<th>IMAGEN</th>-->
      <th>CAMBIO ROL</th>
      <th>CAMBIO ESTADO</th>
      <th>ELIMINAR</th>
    </tr>
    </thead>
    <tbody th:each="user : ${user}">
      <td th:text="${user.id}"></td>
      <td th:text="${user.name}"></td>
      <td th:text="${user.lastName}"></td>
      <td th:text="${user.email}"></td>
      <td th:text="${user.role}"></td>
      <td th:if="${user.status}">ALTA</td>
      <td th:unless="${user.status}"> BAJA</td>
      <!--<td>
         Verificar si el usuario tiene una imagen asociada -->
        <!--<img th:if="${user.image != null}" th:src="@{'/image/carga/' + ${user.image.id}}"
             alt="Imagen de usuario" width="100" height="100">
      </td>-->
      <td><a th:href= "@{/admin/editRole/{id} (id=${user.id})}"class="btn btn-outline-dark">
        Rol</a></td>
      <td><a th:href= "@{/admin/editUserStatus/{id} (id=${user.id})}" class="btn btn-outline-warning"> Alta/Baja </a></td>
      <td><a th:href= "@{/admin/delete/{id} (id=${user.id})}" class="btn btn-outline-danger" >
        Eliminar
      </a> </td>
    </tr>
    </tbody>
  </table>
</div>
</main>

<script>
  // Función para obtener el contenido de texto de un elemento (ignorando etiquetas HTML)
  function getTextContent(element) {
    return element.textContent || element.innerText;
  }

  // Función para ordenar la tabla por la columna indicada
  function sortTable(columnIndex) {
    let table, rows, switching, i, x, y, shouldSwitch;
    table = document.getElementById("userTable");
    switching = true;

    while (switching) {
      switching = false;
      rows = table.rows;

      for (i = 1; i < (rows.length - 1); i++) {
        shouldSwitch = false;
        x = rows[i].getElementsByTagName("TD")[columnIndex];
        y = rows[i + 1].getElementsByTagName("TD")[columnIndex];

        // Obtén el contenido de texto de las celdas (ignorando enlaces)
        const xText = getTextContent(x);
        const yText = getTextContent(y);

        // Compara los valores según el tipo de columna (numérico o alfanumérico)
        if (columnIndex === 0 || columnIndex === 5 || columnIndex === 7) {
          if (Number(xText) > Number(yText)) {
            shouldSwitch = true;
            break;
          }
        } else {
          if (xText.toLowerCase() > yText.toLowerCase()) {
            shouldSwitch = true;
            break;
          }
        }
      }

      if (shouldSwitch) {
        rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
        switching = true;
      }
    }
  }
</script>

</section>
</body>
</html>

